{{ $currentPage := . }}

<div class="book-menu-enhanced">
  <!-- Brand Header -->
  {{ partial "docs/brand-unified" (dict "Site" .Site "context" "sidebar") }}

  <!-- Search Box - Using unified search component -->
  <div class="menu-search">
    {{ partial "docs/search-unified" (dict "Site" .Site "context" "sidebar") }}
  </div>

  <!-- Quick Actions Section -->
  <div class="menu-section">
    <div class="menu-section-header">Quick Actions</div>
    <ul class="menu-section-items">
      <li>
        <a href="/docs/delphi/sign-up/" class="menu-item menu-item-cta">
          Get Started
        </a>
      </li>
    </ul>
  </div>

  <!-- Offerings Section - Auto-discovered -->
  {{ partial "docs/nav-renderer" (dict 
    "currentPage" $currentPage
    "navType" "sidebar"
    "sectionTitle" "Offerings"
    "contentConfig" (dict 
      "contentType" "offerings"
      "section" "/docs"
      "sortBy" "Weight")
    "renderConfig" (dict 
      "expandable" false)) }}

  <!-- Training section removed - now under Resources -->

  <!-- Resources Section - Auto-discovered from top-level /docs/ pages -->
  {{ $docsSection := .Site.GetPage "/docs" }}
  {{ if $docsSection }}
  <div class="menu-section">
    <div class="menu-section-header">Resources</div>
    <ul class="menu-section-items">
      <!-- Documentation overview -->
      {{ $isActive := partial "docs/nav-helpers" (dict "type" "isActiveExact" "currentPage" $currentPage "url" "/docs/") }}
      <li>
        <a href="/docs/" class="menu-item{{ if $isActive }} active{{ end }}">
          Documentation
        </a>
      </li>
      
      <!-- Training now in main menu below -->
      
      <!-- Main menu items (includes Training, Education, About, etc.) -->
      {{ range .Site.Menus.main }}
      {{ $isActive := false }}
      {{ if eq .URL "/docs/" }}
        {{ $isActive = partial "docs/nav-helpers" (dict "type" "isActiveExact" "currentPage" $currentPage "url" .URL) }}
      {{ else }}
        {{ $isActive = partial "docs/nav-helpers" (dict "type" "isActive" "currentPage" $currentPage "url" .URL) }}
      {{ end }}
      <li>
        <a href="{{ .URL }}" class="menu-item{{ if $isActive }} active{{ end }}">
          {{ .Name }}
        </a>
      </li>
      {{ end }}
      
      <!-- Auto-discovered top-level pages (excluding major sections and main menu items) -->
      {{ range $docsSection.Pages.ByWeight }}
        {{ if and (not .Params.bookHidden) (not (in (slice "delphi" "training" "persephone" "phishing-simulation" "education" "governance" "login") .File.Dir)) }}
          {{ $isActive := false }}
          {{ if eq .RelPermalink "/docs/" }}
            {{ $isActive = partial "docs/nav-helpers" (dict "type" "isActiveExact" "currentPage" $currentPage "url" .RelPermalink) }}
          {{ else }}
            {{ $isActive = partial "docs/nav-helpers" (dict "type" "isActive" "currentPage" $currentPage "url" .RelPermalink) }}
          {{ end }}
          <li>
            <a href="{{ .RelPermalink }}" class="menu-item{{ if $isActive }} active{{ end }}">
              {{ .Title }}
            </a>
          </li>
        {{ end }}
      {{ end }}
    </ul>
  </div>
  {{ end }}
</div>